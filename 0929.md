# 更新说明（scripts/、test_util/、RISE_installation_guide.md）

> 更新时间：2025-09-29  
> 分支：feature/0924_new

本文简要介绍本次更新中新增/改进的脚本工具、测试工具与安装指南，帮助你快速理解新增能力并上手使用。

---

## 1) scripts/ 推理与工具脚本

- `launch_franka_interface_server.py`：启动 Franka 机械臂控制与相关服务（相机 / 夹爪），统一入口。
- `collect_data_franka_spacemouse.py`：通过 SpaceMouse 进行示教数据采集，便于构建训练数据集。
- `inference_with_policy_interface_rise.py`：使用 RISE 策略进行推理与执行的主脚本（点云策略）。
- `inference_with_policy_interface_smoothed.py`：在推理控制中加入平滑/滤波的版本，降低抖动。
- `inference_with_policy_interface_act.py`：基于 ACT 策略接口的推理与执行脚本。
- `inference_with_policy_interface_2cam.py`：双相机输入的推理流程，适用于多视角感知。
- `infer_save_image.py`：推理并保存图像/中间可视化结果，便于调试与复现。
- `debug_action_visualization.py`：`inference_with_policy_interface_act.py`+对策略输出的动作进行可视化与调试分析。
- `replay_trajectory.py`：回放历史轨迹，支持离线复盘与调试控制逻辑。
- `rise_save_ply.py`：`inference_with_policy_interface_rise.py`+保存/导出 PLY 点云（含批量保存与调试辅助）。
- `start_server.sh`：一键启动控制与服务端的 Shell 脚本。
- `start_replay.sh`：一键启动轨迹回放流程的 Shell 脚本。
- `example_policy.py`：示例策略接口，便于对接/替换为自定义策略。

> 使用建议：
> - 先运行 `start_server.sh` 或 `launch_franka_interface_server.py` 启动底层服务
> - 再根据需求选择对应推理脚本（如 RISE/ACT、单/双相机、是否平滑）

---

## 2) test_util/ 测试与可视化工具

- `test_open3d_pointcloud.py`：Open3D 点云处理相关的综合测试，验证读写/显示/基本变换。
- `view_pointclouds.py`：通用点云浏览与可视化工具，支持快速查看`rise_save_ply.py`采集/保存的点云。
- `simple_camera_test.py`：相机基础连通性与数据流测试，快速判断驱动/Topic/帧同步状况。
- `test_camera_cam4.py`：针对第 4 路/多相机位的专项测试脚本，辅助多机位场景验证。

> 使用建议：
> - 先用 `simple_camera_test.py` 做基本连通测试
> - 出现显示/点云问题时，用 `test_open3d_pointcloud.py` 与 `view_pointclouds.py` 定位数据质量

---

## 3) RISE_installation_guide.md 安装与环境指南（已更新）

- **目标环境**：Python 3.9、PyTorch 2.4.0+cu121、MinkowskiEngine 0.5.4、PyTorch3D 0.7.8、CUDA 12.1
- **关键步骤**：
  - 使用 Conda 创建 `minkowski_cuda12` 环境；
  - 通过官方索引安装 PyTorch 2.4.0/cu121；
  - 修复 GCC `std::__to_address` 冲突（对 MinkowskiEngine 编译至关重要）；
  - 使用指定分支编译安装 MinkowskiEngine（OpenBLAS）；
  - 安装 RISE 基础依赖与 PyTorch3D；
  - 安装 `model/r3kit` 及缺失依赖（如 `psutil`、`yourdfpy`、`pynput`）。
- **验证**：
  - 提供 MinkowskiEngine 稀疏张量与卷积单元的最小运行示例；
  - 提供 PyTorch / MinkowskiEngine / PyTorch3D / CUDA 的版本与可用性校验。
- **常见问题**：
  - CUDA invalid configuration argument：建议开启 `CUDA_LAUNCH_BLOCKING=1`、限制 `OMP_NUM_THREADS`、确保 `model.eval()`；
  - GCC 编译错误（`std::__to_address` 模糊）：按指南修复；
  - 依赖版本冲突：固定版本、必要时 `--force-reinstall`，并使用 Conda 环境隔离。
- **推理脚本建议**：
  - 在推理前设置环境变量：
    - `CUDA_LAUNCH_BLOCKING=1`（同步调试）
    - `OMP_NUM_THREADS=8`（限制 OpenMP 线程）
  - 增加点云输入的数据有效性检查与裁剪（示例代码已给出）。

---

## 4) 快速开始（示例命令）

1. 启动底层服务（Franka/相机/夹爪等）：
   ```bash
   bash scripts/start_server.sh
   # 或
   python scripts/launch_franka_interface_server.py
   ```

2. 运行 RISE 策略推理（单相机示例）：
   ```bash
   python scripts/inference_with_policy_interface_rise.py
   ```

3. 双相机推理：
   ```bash
   python scripts/inference_with_policy_interface_2cam.py
   ```

4. 推理结果可视化/保存：
   ```bash
   python scripts/infer_save_image.py
   python scripts/debug_action_visualization.py
   ```

5. 采集示教数据与轨迹回放：
   ```bash
   python scripts/collect_data_franka_spacemouse.py
   python scripts/replay_trajectory.py
   ```

6. 点云保存与查看：
   ```bash
   python scripts/rise_save_ply.py
   python test_util/view_pointclouds.py
   ```

---

## 5) 本次更新亮点

- **推理脚本完善**：支持 RISE/ACT、多相机、平滑控制、可视化与中间结果保存。
- **点云工具链**：新增/强化 PLY 点云保存与查看，便于数据检查与问题定位。
- **测试链路更友好**：优化相机与点云测试脚本，快速定位环境与数据问题。
- **安装经验固化**：针对 CUDA12 + MinkowskiEngine 的编译坑位给出可复现的解决方案。

---

如需更详细的参数说明或示例配置，请查看对应脚本内的注释与项目根目录下的 `README.md`。